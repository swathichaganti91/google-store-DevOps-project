<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Phone</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&amp;display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <style>
    :root {
      --google-blue: #1a73e8;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --background-light: #f8f9fa;
      --border-color: #dadce0;
      --green: #34a853;
      --error: #ea4335;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Google Sans', 'Roboto', Arial, sans-serif;
      color: var(--text-primary);
      background-color: white;
      line-height: 1.5;
      min-height: 100vh;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 40px;
    }
    .navbar-left, .navbar-right {
      display: flex;
      align-items: center;
    }
    .logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--google-blue);
      text-decoration: none;
      margin-right: 20px;
    }
    .nav-links a {
      text-decoration: none;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      margin-right: 20px;
      padding: 8px 0;
      transition: color 0.2s;
    }
    .nav-links a:hover {
      color: var(--text-primary);
    }
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;
      font-size: 24px;
      color: var(--text-secondary);
      cursor: pointer;
      margin-left: 20px;
      transition: color 0.2s;
    }
    .material-symbols-outlined:hover {
      color: var(--text-primary);
    }
    /* Login/Signup Navbar Buttons */
    .navbar-auth-btn {
      margin-left: 12px;
      padding: 6px 18px;
      border: 1px solid var(--google-blue);
      border-radius: 20px;
      background: #fff;
      color: var(--google-blue);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.17s, border-color 0.17s, color 0.17s;
      outline: none;
    }
    .navbar-auth-btn:hover {
      background: var(--google-blue);
      color: #fff;
    }
    /* Navbar Profile badge (after login) */
    .navbar-profile-container {
      display: none;
      align-items: center;
      gap: 10px;
      margin-left: 12px;
      /* For transition effect when showing */
      opacity: 0;
      transition: opacity 0.2s;
    }
    .navbar-profile-container.show {
      display: flex;
      opacity: 1;
    }
    .navbar-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--google-blue);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 2px 6px rgba(26,115,232,0.11);
      user-select: none;
    }
    .navbar-profile-name-email {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      line-height: 1.15;
    }
    .navbar-profile-username {
      color: var(--google-blue);
      font-weight: 600;
      font-size: 15px;
      margin-bottom: -3px;
    }
    .navbar-profile-email {
      color: #666;
      font-size: 12px;
      max-width: 140px;
      /* Prevent overflow */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .navbar-logout-btn {
      margin-left: 14px;
      padding: 6px 16px;
      background: #fff;
      color: var(--google-blue);
      border: 1px solid var(--google-blue);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      outline: none;
      transition: background 0.14s, color 0.14s;
    }
    .navbar-logout-btn:hover {
      background: var(--google-blue);
      color: #fff;
    }
    /* AUTH MODAL STYLES */
    .auth-modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(32,33,36,0.39);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .auth-modal-overlay.open {
      display: flex;
    }
    .card#authCard {
      margin: 0;
      max-width: 400px;
      width: 96vw;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 36px 0 rgba(32,33,36,0.16), 0 0px 0px 1px #e2e5ea;
      padding: 32px 35px 26px 35px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 470px;
      position: relative;
      border: 1px solid #e3e6ee;
      justify-content: flex-start;
      box-sizing: border-box;
    }

    /* Fix and enhance the logo for auth modal */
    .auth-logo-google-store {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 24px; /* more space below logo */
      width: 100%;
      height: 60px;
      /* Prevent logo from shrinking/collapsing */
      min-height: 44px;
      min-width: 140px;
      background: transparent;
    }
    .auth-logo-google-store img {
      height: 48px;
      width: auto;
      max-width: 160px;
      max-height: 54px;
      margin: 0 auto;
      display: block;
      background: #fff !important;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(32,33,36,.05);
      object-fit: contain;
      padding: 2px 8px 2px 8px;
    }
    /* End logo fix */

    .auth-close-btn {
      position: absolute;
      top: 18px;
      right: 18px;
      background: none;
      border: none;
      font-size: 22px;
      color: #9BA4AE;
      cursor: pointer;
      z-index: 1;
      transition: color .2s;
    }
    .auth-close-btn:hover {
      color: #d84242;
    }
    #authCard h2#formTitle {
      margin-top: 2px;
      margin-bottom: 28px;
      color: var(--google-blue);
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.5px;
      text-align: center;
    }
    #signupForm, #loginForm {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 18px;
      align-items: stretch;
    }
    #signupForm input,
    #loginForm input {
      padding: 11px 12px;
      border: 1px solid #dadce0;
      border-radius: 6px;
      font-size: 16px;
      background: #f7f8fa;
      color: var(--text-primary);
      transition: border-color 0.18s;
    }
    #signupForm input:focus,
    #loginForm input:focus {
      border-color: var(--google-blue);
      outline: none;
    }
    #signupForm button, #loginForm button {
      padding: 12px 0;
      border: none;
      border-radius: 4px;
      background-color: var(--google-blue);
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: background-color 0.2s;
    }
    #signupForm button:hover,
    #loginForm button:hover {
      background-color: #156acb;
    }
    .switch {
      color: #666;
      margin-bottom: 12px;
      text-align: center;
      font-size: 15px;
    }
    .switch a {
      color: var(--google-blue);
      text-decoration: underline;
      font-weight: 500;
      cursor: pointer;
    }
    .message {
      text-align: center;
      font-size: 15px;
      min-height: 20px;
      margin-bottom: 11px;
      margin-top: 3px;
      border-radius: 4px;
      padding: 5px 3px;
      display: none;
    }
    .message.success {
      color: var(--green);
    }
    .message.error {
      color: var(--error);
    }
    #profile {
      display: none;
      width: 100%;
      margin-top: 17px;
      flex-direction: column;
      align-items: center;
      text-align: center;
      justify-content: center;
    }
    #profile .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--google-blue);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: 500;
      margin: 0 auto 10px auto;
      box-shadow: 0 2px 6px rgba(26,115,232,0.12);
    }
    #profile .profile-info {
      margin-bottom: 12px;
    }
    #profile strong {
      color: var(--google-blue);
      font-size: 18px;
      font-weight: 600;
    }
    #profile-email {
      color: #666;
      font-size: 15px;
    }
    #profile button {
      background-color: #fff;
      color: var(--google-blue);
      font-weight: 500;
      border: 1px solid var(--google-blue);
      border-radius: 3px;
      padding: 9px 22px;
      font-size: 15px;
      cursor: pointer;
      margin-top: 6px;
      transition: background .18s, border-color .18s;
    }
    #profile button:hover {
      background: #f8f9fa;
      border-color: #174ea6;
    }
    .hero-section {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      min-height: calc(100vh - 56px);
      background-color: var(--background-light);
      padding: 50px 20px;
    }
    .hero-section h1 {
      font-size: 80px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 24px;
      max-width: 800px;
    }
    .hero-section p {
      font-size: 18px;
      font-weight: 400;
      color: var(--text-secondary);
      margin-bottom: 40px;
    }
    .cta-button {
      background-color: var(--google-blue);
      color: white;
      font-size: 16px;
      font-weight: 500;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .cta-button:hover {
      background-color: #1669d6;
    }
    .newsletter-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 80px 20px 100px;
      text-align: center;
      background-color: #f8f9fa;
    }
    .newsletter-section .icon {
      font-size: 48px;
      color: var(--google-blue);
      margin-bottom: 24px;
      font-variation-settings: 'FILL' 1,'wght' 400,'GRAD' 0,'opsz' 24;
    }
    .newsletter-section h2 {
      font-size: 36px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 32px;
      max-width: 650px;
    }
    .signup-button {
      background-color: white;
      color: var(--google-blue);
      font-size: 14px;
      font-weight: 500;
      padding: 10px 24px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    .signup-button:hover {
      background-color: #f8f9fa;
      border-color: var(--google-blue);
    }
    .disclaimers-section {
      padding: 60px 40px;
      background-color: #fff;
      border-top: 1px solid var(--border-color);
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.8;
    }
    .disclaimers-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
    }
    .disclaimers-section li {
      margin-bottom: 15px;
      position: relative;
      padding-left: 15px;
    }
    .disclaimers-section li::before {
      content: '*';
      position: absolute;
      left: 0;
      top: 0;
      color: var(--text-secondary);
    }
    .footer {
      padding: 40px 40px;
      background-color: #fff;
      border-top: 1px solid var(--border-color);
    }
    .footer .logo-google-store {
      display: flex;
      align-items: center;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .footer .logo-google-store span {
      font-size: 24px;
      font-weight: 700;
      margin-right: 8px;
      background: linear-gradient(to right, #4285F4, #EA4335, #FBBC05, #4285F4, #34A853, #EA4335);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .footer .google-text { color: #4285F4; }
    .footer .google-text span:nth-child(2) { color: #EA4335; }
    .footer .google-text span:nth-child(3) { color: #FBBC05; }
    .footer .google-text span:nth-child(4) { color: #4285F4; }
    .footer .google-text span:nth-child(5) { color: #34A853; }
    .footer .google-text span:nth-child(6) { color: #EA4335; }

    /* Responsive: shrink modal box on mobile */
    @media (max-width: 480px) {
      .card#authCard {
        max-width: 96vw;
        padding: 18px 8px 14px 8px;
        min-height: unset;
      }
      .auth-logo-google-store {
        margin-bottom: 15px;
        height: 40px;
        min-height: 34px;
      }
      .auth-logo-google-store img {
        height: 34px;
        max-width: 95vw;
        max-height: 40px;
        padding: 1px 5px;
        border-radius: 7px;
      }
      .navbar-profile-container {
        max-width: 70vw;
      }
      .navbar-profile-email {
        max-width: 70vw;
      }
    }
  </style>
</head>
<body>

  <header class="navbar">
  <div class="navbar-left">
    <a href="/" class="logo">
      <span style="color: #4285F4;">G</span><span style="color: #EA4335;">o</span><span style="color: #FBBC05;">o</span><span style="color: #4285F4;">g</span><span style="color: #34A853;">l</span><span style="color: #EA4335;">e</span>
    </a>
    <nav class="nav-links">
  <a href="/electronics" class="btn primary">Electronics</a>
  <a href="/phones" class="btn primary">Phones</a>
  <a href="/computers" class="btn primary">Computers</a>
  <a href="/earphones" class="btn primary">Earphones</a>
  <a href="/payment" class="btn primary">Payment</a>
</nav>
 
  </div>
  <div class="navbar-right">
    <span class="material-symbols-outlined search-icon" style="margin-right: 18px;">search</span>
    <button class="navbar-auth-btn" id="navbar-login-btn">Login</button>
    <button class="navbar-auth-btn" id="navbar-signup-btn">Sign Up</button>

    <!-- Profile container in navbar (shown after login/signup) -->
    <div class="navbar-profile-container" id="navbarProfile">
      <span class="navbar-avatar" id="navbarAvatar"></span>
      <span class="navbar-profile-name-email">
        <span class="navbar-profile-username" id="navbarProfileUsername"></span>
        <span class="navbar-profile-email" id="navbarProfileEmail"></span>
      </span>
      <button class="navbar-logout-btn" id="navbarLogoutBtn">Logout</button>
    </div>
  </div>
</header>

  <!-- AUTH POPUP MODAL (Initially Hidden) -->
  <div class="auth-modal-overlay" id="authModalOverlay">
    <div class="card" id="authCard" tabindex="-1">
      <button class="auth-close-btn" id="closeAuthModal" title="Close">&times;</button>
      <!-- Logo at top -->
      <div class="auth-logo-google-store">
        <img 
          src="https://latestlogo.com/wp-content/uploads/2024/01/google-store-logo.png" 
          alt="Google Store Logo" 
          draggable="false" 
          style="background:#fff; object-fit:contain;"
          loading="lazy"
        />
      </div>
      <h2 id="formTitle">Sign Up</h2>
      <!-- Signup -->
      <div id="signupForm">
        <input type="text" id="su-username" placeholder="Username" required />
        <input type="email" id="su-email" placeholder="Email" required />
        <input type="password" id="su-password" placeholder="Password" required />
        <button onclick="signup()">Create Account</button>
      </div>
      <!-- Login -->
      <div id="loginForm" style="display:none;">
        <input type="email" id="li-email" placeholder="Email" required />
        <input type="password" id="li-password" placeholder="Password" required />
        <button onclick="login()">Login</button>
      </div>
      <div class="switch" id="switchText">
        Already have an account? <a onclick="toggleForm('login')">Login</a>
      </div>
      <div id="msg" class="message"></div>
      <!-- Profile (only shown in modal, not navbar) -->
      <div id="profile">
        <div class="avatar" id="avatar"></div>
        <div class="profile-info">
          <strong id="profile-name"></strong><br>
          <span id="profile-email"></span>
        </div>
        <button onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

  <main class="hero-section">
    <h1>Ask more of your phone.</h1>
    <p>Google Pixel 10 series is here. Say hello to your new phone.</p>
    <button id="cta-button" class="cta-button">Browse phones</button>
    <div style="margin-top: 40px; display: flex; justify-content: center;">
      <video src="https://storage.googleapis.com/mannequin/blobs/4653b46c-99df-4418-af50-b903cdd558c0.mp4" autoplay muted playsinline loop style="max-width: 80%; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.13);">
        Sorry, your browser doesn't support embedded videos.
      </video>
    </div>
    <div style="display: flex; justify-content: center; gap: 32px; margin-top: 52px; flex-wrap: wrap;">
      <a href="electronics/index.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none;">
        <img src="https://images.squarespace-cdn.com/content/v1/5ae8bd2f89c1723a6f6f557b/1565794679412-QOSVO1NO2JF104SBAU4R/AdobeStock_237119664.jpeg" alt="Electronics" style="width: 130px; height: 130px; object-fit: contain; background: #f3f6fb; border-radius: 16px; box-shadow: 0 3px 16px rgba(66,133,244,0.06); margin-bottom: 12px;">
        <span style="font-weight: 500; color: #1a73e8; margin-top: 6px;">Electronics</span>
      </a>
      <a href="phones/index.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none;">
        <img src="https://m-cdn.phonearena.com/images/article/64576-wide-two_1200/The-Best-Phones-to-buy-in-2024---our-top-10-list.jpg" alt="Phones" style="width: 130px; height: 130px; object-fit: contain; background: #f3f6fb; border-radius: 16px; box-shadow: 0 3px 16px rgba(234,67,53,0.06); margin-bottom: 12px;">
        <span style="font-weight: 500; color: #ea4335; margin-top: 6px;">Phones</span>
      </a>
      <a href="computers/index.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none;">
        <img src="https://mecer.co.za/wp-content/uploads/2022/10/1140X810-1.jpg" alt="Computers" style="width: 130px; height: 130px; object-fit: contain; background: #f3f6fb; border-radius: 16px; box-shadow: 0 3px 16px rgba(251,188,5,0.06); margin-bottom: 12px;">
        <span style="font-weight: 500; color: #fbbc05; margin-top: 6px;">Computers</span>
      </a>
      <a href="earphones/index.html" style="display: flex; flex-direction: column; align-items: center; text-decoration: none;">
        <img src="https://techstory.in/wp-content/uploads/2020/02/01LW4049122-HeroSquare-f670a23de42e4206b42e87a61fe486fe.jpg" alt="Earphones" style="width: 130px; height: 130px; object-fit: contain; background: #f3f6fb; border-radius: 16px; box-shadow: 0 3px 16px rgba(52,168,83,0.06); margin-bottom: 12px;">
        <span style="font-weight: 500; color: #34a853; margin-top: 6px;">Earphones</span>
      </a>
    </div>
    <script>
      // The below script is replaced by the global requirement to intercept all clicks for login/signup prompt.
    </script>
  </main>

  <section class="newsletter-section">
      <span class="material-symbols-outlined icon">label</span>
      <h2>Get news, offers, cart reminders, personalised emails, and surveys from the Google Store.</h2>
  </section>
  <section class="disclaimers-section">
      <ul>
          <li>
              All orders delivered free of charge will use the lowest-cost shipping option, unless stated otherwise.
          </li>
          <li>
              Pixel devices generally receive Pixel Drops during the applicable Android update and support periods for the phone. For details, see 
              <a href="https://g.co/pixel/updates" rel="noopener" target="_blank">g.co/pixel/updates</a>.
              Availability of some Pixel Drops may vary by phone and device model.
          </li>
      </ul>
  </section>

  <footer class="footer" style="text-align:center; padding:24px 0;">
      <div class="logo-google-store" style="justify-content:center;">
          <img src="https://latestlogo.com/wp-content/uploads/2024/01/google-store-logo.png" alt="Google Store Logo" style="height:34px; vertical-align:middle; margin-right:8px;" />
      </div>
      <div style="margin-top:12px; font-size:15px; color: #444;">
          Developed by Abinash Kumar
      </div>
  </footer>

  <script>
    // === Configuration ===
    const SIGNUP_URL = 'http://ad590a2d36f1c41d9b66a8c68e3764c5-2139266970.ap-northeast-1.elb.amazonaws.com/api/signup';
    const LOGIN_URL  = 'http://ad590a2d36f1c41d9b66a8c68e3764c5-2139266970.ap-northeast-1.elb.amazonaws.com/api/login';

    const msgBox = document.getElementById("msg");

    // Navbar references for profile info and auth btns
    const navbarProfile = document.getElementById('navbarProfile');
    const navbarAvatar = document.getElementById('navbarAvatar');
    const navbarProfileUsername = document.getElementById('navbarProfileUsername');
    const navbarProfileEmail = document.getElementById('navbarProfileEmail');
    const navbarLogoutBtn = document.getElementById('navbarLogoutBtn');
    const navbarLoginBtn = document.getElementById('navbar-login-btn');
    const navbarSignupBtn = document.getElementById('navbar-signup-btn');

    // Auth modal "profile" references
    const modalProfile = document.getElementById("profile"); // not shown in navbar

    // Track if the user is authenticated in this session
    let isLoggedIn = false;

    function showMessage(text, type) {
      msgBox.textContent = text;
      msgBox.className = `message ${type}`;
      msgBox.style.display = "block";
      setTimeout(() => msgBox.style.display = "none", 4000);
    }

    function openAuthModal(mode = "signup") {
      toggleForm(mode);
      // Show overlay
      document.getElementById('authModalOverlay').classList.add('open');
      setTimeout(() => document.getElementById('authCard').focus(), 100);
    }

    function closeAuthModal() {
      document.getElementById('authModalOverlay').classList.remove('open');
      // Reset profile view on close
      toggleForm('signup');
      document.getElementById("profile").style.display = "none";
      document.getElementById("switchText").style.display = "block";
      document.getElementById("formTitle").textContent = "Sign Up";
      msgBox.style.display = "none";
    }

    // Attach modal open/close events and click interception logic
    document.addEventListener('DOMContentLoaded', function() {
      // Handle Login/Sign Up buttons
      navbarLoginBtn.onclick = function() {
        openAuthModal('login');
        return false;
      };
      navbarSignupBtn.onclick = function() {
        openAuthModal('signup');
        return false;
      };
      document.getElementById('closeAuthModal').onclick = function() {
        closeAuthModal();
      };
      // Close popup if clicking outside the modal
      document.getElementById('authModalOverlay').addEventListener('mousedown', function(e) {
        if (e.target === this) closeAuthModal();
      });
      // Prevent Enter key from submitting form if not focused on button/input
      document.getElementById('authCard').addEventListener('keydown', function(e){
        if(e.key==='Escape'){ closeAuthModal(); }
      });

      // Navbar Logout button event
      navbarLogoutBtn.onclick = function() {
        logout();
      };

      // --- GLOBAL CLICK INTERCEPT FOR LOGIN/SIGNUP PROMPT ---
      document.body.addEventListener('click', function(event) {
        // If already logged in, allow default
        if (isLoggedIn) return;

        // Don't intercept clicks in the auth modal itself, or on modal backdrop, or on login/signup btn
        let target = event.target;

        // Allow if click inside auth modal or on auth modal overlay
        if (target.closest('#authCard') || target.closest('#authModalOverlay')) return;

        // If on login/signup buttons, let their handlers fire (don't block)
        if (
          target === navbarLoginBtn ||
          target === navbarSignupBtn
        ) return;

        // Don't block logout (let it work in the modal)
        if (target.closest('#profile') || target.closest('.navbar-profile-container')) return;

        // Prevent default navigation/interaction
        let isInteractive = false;
        let tag = target.tagName.toLowerCase();
        if (
          tag === 'a' ||
          tag === 'button' ||
          tag === 'video' ||
          tag === 'input' ||
          tag === 'img' ||
          tag === 'span' ||
          tag === 'svg' || target.classList.contains('cta-button')
        ) isInteractive = true;

        // If clicked element is something interactive (likely to need an account), intercept it
        if (isInteractive) {
          event.preventDefault();
          showMessage("Please sign up or login to access this feature.", "error");
          setTimeout(() => openAuthModal('signup'), 600); // Give user feedback, then open modal
        }
      }, true); // Use capture so we catch before links/buttons

    });

    function toggleForm(mode) {
      const signupForm = document.getElementById("signupForm");
      const loginForm = document.getElementById("loginForm");
      const title = document.getElementById("formTitle");
      const switchText = document.getElementById("switchText");
      const profile = document.getElementById("profile");

      msgBox.style.display = "none";
      profile.style.display = "none";

      if (mode === "login") {
        signupForm.style.display = "none";
        loginForm.style.display = "flex";
        title.textContent = "Login";
        switchText.innerHTML = `Don't have an account? <a onclick="toggleForm('signup')">Sign up</a>`;
      } else {
        loginForm.style.display = "none";
        signupForm.style.display = "flex";
        title.textContent = "Sign Up";
        switchText.innerHTML = `Already have an account? <a onclick="toggleForm('login')">Login</a>`;
      }
      switchText.style.display = "block";
    }

    async function signup() {
      const username = document.getElementById("su-username").value.trim();
      const email = document.getElementById("su-email").value.trim();
      const password = document.getElementById("su-password").value.trim();

      if (!username || !email || !password) {
        showMessage("All fields are required.", "error");
        return;
      }

      try {
        const res = await fetch(SIGNUP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, email, password })
        });

        const data = await res.json();
        if (res.ok) {
          showMessage(data.message || "Signup successful!", "success");
          setTimeout(() => {
            // Autofill navbar with this user after signup
            onUserAuthenticated({ username, email });
            closeAuthModal();
          }, 800);
        } else {
          showMessage(data.error || "Signup failed.", "error");
        }
      } catch (err) {
        showMessage("Network or server error.", "error");
      }
    }

    async function login() {
      const email = document.getElementById("li-email").value.trim();
      const password = document.getElementById("li-password").value.trim();

      if (!email || !password) {
        showMessage("Both fields are required.", "error");
        return;
      }

      try {
        const res = await fetch(LOGIN_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        if (res.ok) {
          // derive name from email if not returned
          const derivedName = email.split("@")[0];
          const displayName = data.username || derivedName;
          showMessage(`Welcome, ${displayName}!`, "success");

          // Show profile info in modal
          document.getElementById("signupForm").style.display = "none";
          document.getElementById("loginForm").style.display = "none";
          document.getElementById("switchText").style.display = "none";
          document.getElementById("formTitle").textContent = "Your Profile";
          document.getElementById("profile-name").textContent = displayName;
          document.getElementById("profile-email").textContent = email;
          document.getElementById("avatar").textContent = displayName[0].toUpperCase();
          document.getElementById("profile").style.display = "flex";

          // Also show profile in navbar, hide login/signup
          setTimeout(() => {
            onUserAuthenticated({ username: displayName, email: email });
            closeAuthModal();
          }, 950);

        } else {
          showMessage(data.error || "Invalid credentials.", "error");
        }
      } catch (err) {
        showMessage("Network or server error.", "error");
      }
    }

    // Show profile in navbar, hide login/signup
    function onUserAuthenticated({ username, email }) {
      // Set the navbar profile info
      navbarAvatar.textContent = username?.charAt(0).toUpperCase() || '?';
      navbarProfileUsername.textContent = username || '';
      navbarProfileEmail.textContent = email || '';
      // Show profile, hide login/signup btns
      navbarProfile.classList.add('show');
      navbarProfile.style.display = 'flex';
      navbarLoginBtn.style.display = 'none';
      navbarSignupBtn.style.display = 'none';
      isLoggedIn = true;
    }

    // Hide profile in navbar, restore login/signup
    function onUserLoggedOut() {
      navbarProfile.classList.remove('show');
      navbarProfile.style.display = 'none';
      navbarLoginBtn.style.display = 'inline-block';
      navbarSignupBtn.style.display = 'inline-block';
      isLoggedIn = false;
    }

    function logout() {
      // Hide modal profile if open
      toggleForm("login");
      document.getElementById("profile").style.display = "none";
      document.getElementById("switchText").style.display = "block";
      document.getElementById("formTitle").textContent = "Login";
      showMessage("Logged out successfully.", "success");

      // Hide navbar profile, restore login/signup buttons
      onUserLoggedOut();
    }
  </script>

</body>
</html>


